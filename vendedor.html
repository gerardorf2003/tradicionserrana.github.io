<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Panel Vendedor | Tradici√≥n Serrana</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
:root { 
    --verde-serrano: #2d5a27; 
    --verde-oscuro: #1b3d1a;
    --crema: #fdfcf9; 
}

body {
    background: linear-gradient(135deg, #fdfcf9, #eef3ec);
    font-family: 'Poppins', sans-serif;
}

.auth-card, .upload-card {
    border-radius: 20px;
    border: none;
    animation: fadeUp 0.5s ease;
}

.auth-card {
    max-width: 420px;
    margin: 100px auto;
}

.upload-card {
    max-width: 650px;
    margin: 60px auto;
}


.btn-verde {
    background: linear-gradient(135deg, var(--verde-serrano), var(--verde-oscuro));
    color: white;
    border-radius: 30px;
    padding: 10px;
    font-weight: 600;
    transition: 0.3s;
}
.btn-verde:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 20px rgba(0,0,0,0.2);
    color: white;
}

.form-control {
    border-radius: 15px;
    padding: 12px;
}

@keyframes fadeUp {
    from { opacity: 0; transform: translateY(15px); }
    to { opacity: 1; transform: translateY(0); }
}

#mensaje {
    font-size: 0.9rem;
}
</style>
</head>

<body>

<div class="container">

<div id="auth-box" class="card auth-card shadow p-4">
    <h3 class="text-center mb-4">üèîÔ∏è Acceso Comerciantes</h3>

    <div id="mensaje" class="text-danger text-center mb-3"></div>

    <input type="email" id="email" class="form-control mb-3" placeholder="Correo electr√≥nico">
    <input type="password" id="pass" class="form-control mb-3" placeholder="Contrase√±a">

    <button id="btn-login" class="btn btn-verde w-100 mb-2">Iniciar Sesi√≥n</button>
    <button id="btn-registro" class="btn btn-outline-secondary w-100 rounded-pill">Crear Cuenta</button>
</div>

<div id="upload-box" class="card upload-card shadow p-4 d-none">

    <div class="d-flex justify-content-between align-items-center mb-4">
        <h4>üì¶ Publicar Nuevo Producto</h4>
        <button id="btn-logout" class="btn btn-sm btn-danger rounded-pill">Cerrar Sesi√≥n</button>
    </div>

    <form id="form-producto">

        <div class="mb-3">
            <input type="text" id="p-nombre" class="form-control" placeholder="Nombre del producto" required>
        </div>

        <div class="mb-3">
            <input type="number" id="p-precio" class="form-control" placeholder="Precio ($)" required>
        </div>

        <div class="mb-3">
            <input type="text" id="p-ubicacion" class="form-control" placeholder="Ubicaci√≥n (ej. Municipio)" required>
        </div>

        <div class="mb-3">
            <textarea id="p-desc" class="form-control" placeholder="Descripci√≥n breve" rows="3" required></textarea>
        </div>

        <div class="mb-3">
            <label class="form-label small">Foto del producto</label>
            <input type="file" id="p-img" class="form-control" accept="image/*" required>
        </div>

        <button type="submit" id="btn-subir" class="btn btn-verde w-100">
            Publicar en Cat√°logo
        </button>

    </form>

    <div id="mensaje-exito" class="text-success text-center mt-3"></div>

</div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js";
import { getFirestore, addDoc, collection } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js";

const firebaseConfig = {
    apiKey: "AIzaSyDTeO88X2kS5Y35VifPK-Xp9aojdHwCEqc",
  authDomain: "tradicion-serrana-9eddb.firebaseapp.com",
  projectId: "tradicion-serrana-9eddb",
  storageBucket: "tradicion-serrana-9eddb.firebasestorage.app",
  messagingSenderId: "1029895692370",
  appId: "1:1029895692370:web:eaa51b96aeebc030ff3f8b",
  measurementId: "G-0ZKWW4YNX0"
};

const CLOUD_NAME = "dk4fn5bun";
const UPLOAD_PRESET = "tradicion_preset";

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

const mensaje = document.getElementById("mensaje");
const mensajeExito = document.getElementById("mensaje-exito");

onAuthStateChanged(auth, user => {
    document.getElementById('auth-box').classList.toggle('d-none', user);
    document.getElementById('upload-box').classList.toggle('d-none', !user);
});

document.getElementById('btn-registro').onclick = async () => {
    mensaje.innerText = "";
    try {
        await createUserWithEmailAndPassword(auth, email.value, pass.value);
    } catch (e) {
        mensaje.innerText = "Error: " + e.message;
    }
};

document.getElementById('btn-login').onclick = async () => {
    mensaje.innerText = "";
    try {
        await signInWithEmailAndPassword(auth, email.value, pass.value);
    } catch (e) {
        mensaje.innerText = "Correo o contrase√±a incorrectos.";
    }
};

document.getElementById('btn-logout').onclick = () => signOut(auth);

document.getElementById('form-producto').onsubmit = async (e) => {
    e.preventDefault();

    const file = document.getElementById('p-img').files[0];
    const btnSubir = document.getElementById('btn-subir');
    btnSubir.disabled = true;
    btnSubir.innerText = "Subiendo...";

    const formData = new FormData();
    formData.append('file', file);
    formData.append('upload_preset', UPLOAD_PRESET);

    try {
        const cloudRes = await fetch(`https://api.cloudinary.com/v1_1/${CLOUD_NAME}/image/upload`, {
            method: 'POST',
            body: formData
        });
        const cloudData = await cloudRes.json();

        await addDoc(collection(db, "productos"), {
    nombre: document.getElementById('p-nombre').value,
    precio: document.getElementById('p-precio').value,
    ubicacion: document.getElementById('p-ubicacion').value,
    descripcion: document.getElementById('p-desc').value,
    imagenUrl: cloudData.secure_url,
    vendedorEmail: auth.currentUser.email,
    createdAt: new Date()
});
        mensajeExito.innerText = "‚úÖ Producto publicado correctamente.";
        e.target.reset();

    } catch (error) {
        mensaje.innerText = "Error al subir el producto.";
    }

    btnSubir.disabled = false;
    btnSubir.innerText = "Publicar en Cat√°logo";
};
</script>

</body>
</html>

